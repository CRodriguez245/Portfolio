<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>About - Carlos Rodriguez</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@500;700&family=Nuosu+SIL&display=swap" rel="stylesheet">
            <script src="simple-context-sidekick.js"></script>
        <script src="openai-sidekick.js"></script>
    <style>
        @font-face {
            font-family: "Helvetica Neue";
            src: url("fonts/HelveticaNeue-Light.woff2") format("woff2");
            font-weight: 300;
        }
        @font-face {
            font-family: "Helvetica Neue";
            src: url("fonts/HelveticaNeue-Medium.woff2") format("woff2");
            font-weight: 500;
        }
        @font-face {
            font-family: "Helvetica Neue";
            src: url("fonts/HelveticaNeue-Bold.woff2") format("woff2");
            font-weight: 700;
        }
        .font-helvetica {
            font-family: "Helvetica Neue", sans-serif;
        }
        .font-nuosu {
            font-family: "Nuosu SIL", serif;
        }
        .nav-link {
            position: relative;
            text-decoration: none;
        }
        .nav-link::after {
            content: "";
            position: absolute;
            width: 100%;
            height: 1px;
            bottom: -4px;
            left: 0;
            background-color: #000000;
            transform: scaleX(0);
            transform-origin: bottom right;
            transition: transform 0.3s ease;
        }
        .nav-link:hover::after {
            transform: scaleX(1);
            transform-origin: bottom left;
        }
        .nav-link.active::after {
            transform: scaleX(1);
        }
        * {
            cursor: none;
        }
        .cursor {
            width: 12px;
            height: 12px;
            background-color: #5E5E5E;
            border-radius: 50%;
            position: fixed;
            pointer-events: none;
            z-index: 99999;
            transition: transform 0.2s ease, background-color 0.3s ease;
        }
        .cursor.hover {
            transform: scale(1.5);
        }
        .cursor.navigating {
            background-color: #18A000;
            transform: scale(1.5);
        }
        input, textarea {
            cursor: text;
        }
        a, button {
            cursor: none;
        }
        .contact-dropdown {
            cursor: none;
        }
        .contact-dropdown:hover {
            cursor: none;
        }
        .contact-dropdown + div a {
            cursor: none;
        }
        
        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .nav-link::after {
                width: 100%;
            }
            
            #ai-sidekick {
                width: 60px !important;
                height: 60px !important;
                max-width: 60px !important;
                border-radius: 0 !important;
                bottom: 20px !important;
                right: 20px !important;
                margin: 0 !important;
                left: auto !important;
            }
            
            #ai-sidekick #sidekick-button {
                width: 100% !important;
                height: 100% !important;
                padding: 0 !important;
                border-radius: 0 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            #ai-sidekick #sidekick-text {
                font-size: 16px !important;
                font-weight: bold !important;
            }
            
            #ai-sidekick.mobile-fullscreen {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                z-index: 10000 !important;
                background: white !important;
                border-radius: 0 !important;
                margin: 0 !important;
                padding: 0 !important;
                display: flex !important;
                flex-direction: column !important;
                max-width: none !important;
                max-height: none !important;
                transform: none !important;
                height: -webkit-fill-available !important;
                min-height: -webkit-fill-available !important;
                transition: all 0.3s ease-in-out !important;
            }
            
            #ai-sidekick.mobile-fullscreen #chat-container {
                flex: 1 !important;
                display: flex !important;
                flex-direction: column !important;
                padding: 0 !important;
            }
            
            #ai-sidekick.mobile-fullscreen #chat-messages {
                flex: 1 !important;
                padding: 20px !important;
                flex-direction: column !important;
                justify-content: flex-end !important;
                margin-top: 60px !important;
                -webkit-overflow-scrolling: touch !important;
                -webkit-transform: translateZ(0) !important;
                transform: translateZ(0) !important;
            }
            
            #ai-sidekick.mobile-fullscreen #chat-messages p {
                margin: 0 !important;
                padding: 8px 0 !important;
                flex-shrink: 0 !important;
            }
            
            #ai-sidekick.mobile-fullscreen #chat-input-container {
                position: sticky !important;
                bottom: 0 !important;
                background: white !important;
                padding: 20px !important;
                border-top: 1px solid #e5e7eb !important;
                width: 100% !important;
                flex-shrink: 0 !important;
                -webkit-transform: translateZ(0) !important;
                transform: translateZ(0) !important;
            }
            
            #ai-sidekick.mobile-fullscreen #sidekick-button {
                position: fixed !important;
                top: 10px !important;
                right: 10px !important;
                width: 40px !important;
                height: 40px !important;
                padding: 0 !important;
                border-radius: 0 !important;
                background: rgba(255, 255, 255, 0.9) !important;
                z-index: 99999 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                border: none !important;
                left: auto !important;
                transform: none !important;
                pointer-events: auto !important;
                transition: all 0.3s ease-in-out !important;
            }
            
            /* White bar to cut off chat log before X button */
            #ai-sidekick.mobile-fullscreen::before {
                content: '' !important;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                width: 100% !important;
                height: 60px !important;
                background: white !important;
                z-index: 99998 !important;
                pointer-events: none !important;
            }
            
            #ai-sidekick.mobile-fullscreen #sidekick-text {
                font-size: 24px !important;
                font-weight: bold !important;
                color: #18a000 !important;
                z-index: 99999 !important;
                transition: all 0.3s ease-in-out !important;
            }
            
            #ai-sidekick.mobile-fullscreen input,
            #ai-sidekick.mobile-fullscreen textarea {
                font-size: 16px !important;
                transform: none !important;
            }
            
            #main-content.mobile-hidden {
                display: none;
                transition: opacity 0.3s ease-in-out !important;
            }
            
            /* Mobile email popup positioning */
            #email-popup {
                position: fixed !important;
                top: 16px !important;
                left: 65% !important;
                transform: translateX(-50%) !important;
                bottom: auto !important;
                right: auto !important;
                z-index: 10001 !important;
                background: transparent !important;
                backdrop-filter: none !important;
                border: none !important;
                border-radius: 0 !important;
                padding: 8px 12px !important;
                box-shadow: none !important;
                font-size: 12px !important;
                font-weight: 500 !important;
                color: #374151 !important;
                white-space: nowrap !important;
            }
            
            /* Hide custom cursor on mobile */
            * {
                cursor: auto;
            }
            .cursor {
                display: none !important;
            }
        }
    </style>
</head>
<body class="bg-white">
    <!-- Custom cursor -->
    <div class="cursor" id="cursor"></div>

    <!-- Main Content Area (responsive width) -->
    <div class="w-full md:w-3/4 overflow-x-hidden transition-all duration-500 ease-in-out" id="main-content">
        <!-- Navigation -->
        <nav class="fixed w-full md:w-3/4 z-50 transition-all duration-500 ease-in-out" id="main-nav">
            <div class="bg-white/80 backdrop-blur-lg px-4 md:px-12 py-4 md:py-6">
                <div class="flex justify-between items-center">
                    <h1 class="text-[20px] md:text-[28px] font-nuosu">Carlos Rodriguez</h1>
                    
                    <!-- Mobile Email Popup Space -->
                    <div class="md:hidden flex-1 mx-4"></div>
                    
                    <div class="hidden md:flex space-x-12">
                        <a href="index.html" class="text-[16px] font-helvetica font-light nav-link relative">Home</a>
                        <a href="projects.html" class="text-[16px] font-helvetica font-light nav-link relative">Projects</a>
                        <a href="https://docs.google.com/document/d/1RXj2iDbQUYEA5Zh2meN2EXdoaU2CWZfN_qSqDnq9CNY/edit?tab=t.0" target="_blank" class="text-[16px] font-helvetica font-light nav-link relative">Resume</a>
                        <a href="about.html" class="text-[16px] font-helvetica font-light nav-link active relative">About</a>
                        <div class="relative group">
                            <button class="text-[16px] font-helvetica font-light nav-link relative contact-dropdown">Contact</button>
                            <div class="absolute top-full right-0 mt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible contact-dropdown-menu transition-all duration-200 z-[9999]">
                                <div class="relative pr-4">
                                    <div class="bg-white/80 backdrop-blur-sm rounded-sm px-3 py-2">
                                        <div class="space-y-2 text-right">
                                            <p class="text-[14px] font-helvetica font-bold text-black whitespace-nowrap">Let's build something thoughtful.</p>
                                            <div class="space-y-1">
                                                <button onclick="copyEmail()" class="block text-[14px] font-helvetica font-light hover:text-[#18a000] transition-colors text-right w-full">c.a.rodriguez1999@gmail.com</button>
                                                <a href="https://www.linkedin.com/in/carloscoding/" target="_blank" class="block text-[14px] font-helvetica font-light hover:text-[#18a000] transition-colors">LinkedIn</a>
                                                <a href="https://github.com/CRodriguez245" target="_blank" class="block text-[14px] font-helvetica font-light hover:text-[#18a000] transition-colors">GitHub</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="absolute top-0 right-0 w-0.5 bg-black h-0 group-hover:h-full transition-all duration-500 ease-out"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mobile Menu Button -->
                    <button id="mobile-menu-btn" class="md:hidden text-black">
                        <!-- Hamburger Icon -->
                        <svg class="w-6 h-6" id="hamburger-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                        <!-- X Icon -->
                        <svg class="w-6 h-6 hidden" id="x-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- Mobile Navigation Menu -->
                <div id="mobile-menu" class="md:hidden hidden pt-4">
                    <div class="flex flex-col space-y-4">
                        <a href="index.html" class="text-[16px] font-helvetica font-light nav-link relative">Home</a>
                        <a href="projects.html" class="text-[16px] font-helvetica font-light nav-link relative">Projects</a>
                        <a href="https://docs.google.com/document/d/1RXj2iDbQUYEA5Zh2meN2EXdoaU2CWZfN_qSqDnq9CNY/edit?tab=t.0" target="_blank" class="text-[16px] font-helvetica font-light nav-link relative">Resume</a>
                        <a href="about.html" class="text-[16px] font-helvetica font-light nav-link active relative">About</a>
                        <div class="relative" id="mobile-contact-dropdown">
                            <button class="text-[16px] font-helvetica font-light nav-link relative contact-dropdown" onclick="toggleMobileContact()">Contact</button>
                            <div class="mt-2 opacity-0 invisible contact-dropdown-menu transition-all duration-200" id="mobile-contact-menu">
                                <div class="relative pl-2">
                                    <div class="px-3 py-2">
                                        <div class="space-y-2 text-left">
                                            <p class="text-[14px] font-helvetica font-bold text-black whitespace-nowrap">Let's build something thoughtful.</p>
                                            <div class="space-y-1">
                                                <button onclick="copyEmail()" class="block text-[14px] font-helvetica font-light hover:text-[#18a000] transition-colors text-left w-full">c.a.rodriguez1999@gmail.com</button>
                                                <a href="https://www.linkedin.com/in/carloscoding/" target="_blank" class="block text-[14px] font-helvetica font-light hover:text-[#18a000] transition-colors">LinkedIn</a>
                                                <a href="https://github.com/CRodriguez245" target="_blank" class="block text-[14px] font-helvetica font-light hover:text-[#18a000] transition-colors">GitHub</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="absolute top-0 left-0 w-0.5 bg-black h-0 transition-all duration-500 ease-out" id="mobile-contact-line"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Content Section -->
        <div class="max-w-[960px] mx-auto pt-20 md:pt-24 px-4 md:px-12">
            <!-- Hero Text -->
            <div class="mb-16 md:mb-32">
                <h2 class="text-[24px] md:text-[32px] font-helvetica font-medium">How I think, build, and show up.</h2>
            </div>

            <!-- About Content -->
            <div>
                <!-- Profile Image with Animation -->
                <div class="w-full group mb-8 relative">
                    <!-- Animation Area (Left Side) -->
                    <div class="absolute left-0 top-0 w-1/2 h-full overflow-hidden group z-10" id="about-animation">
                        <!-- Image Protection Zone (exclude from animation) -->
                        <div class="absolute top-0 right-0 w-full h-full pointer-events-none"></div>
                        
                        <!-- Hover Zones -->
                        <div class="absolute top-0 left-0 w-full h-1/3 cursor-pointer" data-zone="top-left"></div>
                        <div class="absolute top-1/3 left-0 w-full h-1/3 cursor-pointer" data-zone="middle-left"></div>
                        <div class="absolute bottom-0 left-0 w-full h-1/3 cursor-pointer" data-zone="bottom-left"></div>
                        
                        <!-- Animation Lines -->
                        <div class="absolute top-4 left-4 w-1/4 h-px bg-[#18A000] transform scale-x-0 transition-transform duration-500 ease-out origin-left" data-animation="about-line-1"></div>
                        <div class="absolute top-8 left-4 w-px h-1/4 bg-[#18A000] transform scale-y-0 transition-transform duration-400 ease-out origin-top" data-animation="about-line-2"></div>
                        <div class="absolute top-12 left-8 w-1/6 h-0.5 bg-[#18A000] transform scale-x-0 transition-transform duration-600 ease-out origin-left" data-animation="about-line-3"></div>
                        <div class="absolute top-16 left-4 w-0.5 h-1/6 bg-[#18A000] transform scale-y-0 transition-transform duration-500 ease-out origin-top" data-animation="about-line-4"></div>
                        <div class="absolute top-20 left-8 w-1/8 h-px bg-[#18A000] transform scale-x-0 transition-transform duration-700 ease-out origin-left" data-animation="about-line-5"></div>
                        <div class="absolute top-24 left-4 w-px h-1/8 bg-[#18A000] transform scale-y-0 transition-transform duration-600 ease-out origin-top" data-animation="about-line-6"></div>
                        <div class="absolute top-28 left-8 w-1/6 h-0.5 bg-[#18A000] transform scale-x-0 transition-transform duration-500 ease-out origin-left" data-animation="about-line-7"></div>
                        <div class="absolute top-32 left-4 w-0.5 h-1/6 bg-[#18A000] transform scale-y-0 transition-transform duration-700 ease-out origin-top" data-animation="about-line-8"></div>
                        <div class="absolute top-36 left-8 w-1/4 h-px bg-[#18A000] transform scale-x-0 transition-transform duration-600 ease-out origin-left" data-animation="about-line-9"></div>
                        <div class="absolute top-40 left-4 w-px h-1/4 bg-[#18A000] transform scale-y-0 transition-transform duration-500 ease-out origin-top" data-animation="about-line-10"></div>
                        <div class="absolute top-44 left-8 w-1/6 h-0.5 bg-[#18A000] transform scale-x-0 transition-transform duration-700 ease-out origin-left" data-animation="about-line-11"></div>
                        <div class="absolute top-48 left-4 w-0.5 h-1/6 bg-[#18A000] transform scale-y-0 transition-transform duration-600 ease-out origin-top" data-animation="about-line-12"></div>
                    </div>
                    
                    <!-- Image Container -->
                    <div class="w-full">
                        <img src="images/aboutmeedges copy.jpeg" alt="Carlos Rodriguez" class="w-full object-contain">
                    </div>
                </div>

                <!-- About Text -->
                <div class="max-w-[800px] mx-auto">
                    <h2 class="text-[28px] md:text-[36px] font-nuosu mb-4">About Me</h2>
                    <div class="text-[14px] md:text-[16px] font-helvetica space-y-4 md:space-y-6">
                        <p>I'm Carlos Rodriguez, a product manager and design strategist working at the intersection of healthcare, education, and human-centered AI. I lead products and programs from concept to scaled impact—defining vision, prioritizing features, aligning cross-functional teams, and delivering measurable outcomes.</p>
                        
                        <p>With a background in computer science and a graduate education in design strategy from the Institute of Design, I've launched AI-powered research tools for first-generation students, embedded Microsoft Copilot into healthcare education, and re-architected cohort-based programs to remove structural barriers.</p>
                        
                        <p>My approach combines PM discipline—roadmapping, trade-off analysis, metrics-driven iteration—with human-centered design:</p>
                        
                        <ul class="list-disc pl-8 space-y-2">
                            <li>Designing frameworks that scale with integrity</li>
                            <li>Facilitating alignment across diverse stakeholders</li>
                            <li>Prototyping experiences where AI supports human judgment, not replaces it</li>
                        </ul>
                        
                        <p>I'm driven to build products that advance equity, strengthen systems, and create lasting value. If you're working on AI or education products that blend technology, strategy, and impact, let's connect.</p>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <footer class="bg-white border-t border-gray-200 mt-12 md:mt-20">
                <!-- Desktop Footer -->
                <div class="hidden md:block max-w-7xl mx-auto px-4 md:px-12 py-6 md:py-8">
                    <div class="flex flex-col md:flex-row md:justify-between md:items-center space-y-4 md:space-y-0">
                        <div class="flex flex-col md:flex-row md:items-center space-y-4 md:space-y-0 md:space-x-8">
                            <div>
                                <h3 class="text-[18px] md:text-[20px] font-nuosu mb-0">Carlos Rodriguez</h3>
                                <p class="text-[12px] md:text-[14px] font-helvetica font-light text-gray-600">AI Product Manager</p>
                            </div>
                            <div class="hidden md:block border-l border-gray-300 h-12"></div>
                            <div class="hidden md:block">
                                <p class="text-[12px] md:text-[14px] font-helvetica font-light text-gray-600 mb-1">Let's build something thoughtful.</p>
                                <div class="flex space-x-4">
                                    <button onclick="copyEmail()" class="text-[12px] md:text-[14px] font-helvetica font-light text-gray-600 hover:text-[#18a000] transition-colors">Email</button>
                                    <a href="https://www.linkedin.com/in/carloscoding/" target="_blank" class="text-[12px] md:text-[14px] font-helvetica font-light text-gray-600 hover:text-[#18a000] transition-colors">LinkedIn</a>
                                    <a href="https://github.com/CRodriguez245" target="_blank" class="text-[12px] md:text-[14px] font-helvetica font-light text-gray-600 hover:text-[#18a000] transition-colors">GitHub</a>
                                </div>
                            </div>
                        </div>
                        <div class="hidden md:block text-center md:text-right">
                            <p class="text-[14px] font-helvetica font-light text-gray-600">© 2025 Carlos Rodriguez</p>
                            <p class="text-[12px] font-helvetica font-light text-gray-500 mt-1">Co-founder of <span class="text-[#9a472f]">Better Problems</span></p>
                            <p class="text-[12px] font-helvetica font-light text-gray-500 mt-1">Powered by <span class="text-[#18a000]">Cursor AI</span>, Figma, and GPT</p>
                        </div>
                    </div>
                </div>
                
                <!-- Mobile Footer -->
                <div class="md:hidden px-4 py-6">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-[18px] font-nuosu mb-0">Carlos Rodriguez</h3>
                            <p class="text-[12px] font-helvetica font-light text-gray-600">AI Product Manager</p>
                        </div>
                        <div>
                            <p class="text-[12px] font-helvetica font-light text-gray-600 mb-1">Let's build something thoughtful.</p>
                            <div class="flex space-x-4">
                                <button onclick="copyEmail()" class="text-[12px] font-helvetica font-light text-gray-600 hover:text-[#18a000] transition-colors">Email</button>
                                <a href="https://www.linkedin.com/in/carloscoding/" target="_blank" class="text-[12px] font-helvetica font-light text-gray-600 hover:text-[#18a000] transition-colors">LinkedIn</a>
                                <a href="https://github.com/CRodriguez245" target="_blank" class="text-[12px] font-helvetica font-light text-gray-600 hover:text-[#18a000] transition-colors">GitHub</a>
                            </div>
                        </div>
                    </div>
                    <div class="text-center">
                        <p class="text-[14px] font-helvetica font-light text-gray-600">© 2025 Carlos Rodriguez</p>
                        <p class="text-[12px] font-helvetica font-light text-gray-500 mt-1">Co-founder of <span class="text-[#9a472f]">Better Problems</span></p>
                        <p class="text-[12px] font-helvetica font-light text-gray-500 mt-1">Powered by <span class="text-[#18a000]">Cursor AI</span>, Figma, and GPT</p>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <!-- Email Copy Popup -->
    <div id="email-popup" class="fixed top-4 right-4 text-gray-700 px-3 py-2 font-helvetica text-[12px] z-[10000] transition-all duration-300 ease-in-out" style="display: none; opacity: 0; transform: translateY(-10px);">
        <span>Email copied to clipboard</span>
        <!-- Rolling line animation -->
        <div class="absolute top-0 right-0 w-1 h-full bg-black transform scale-y-0 transition-transform duration-500 ease-out origin-top" id="popup-line"></div>
    </div>

    <!-- AI Sidekick -->
    <div class="fixed bottom-0 right-8 w-1/4 max-w-[394px] flex flex-col z-[9999] transition-all duration-500 ease-in-out" id="ai-sidekick">
        <div class="overflow-hidden transition-all duration-500 ease-in-out" id="chat-container">
            <div class="font-['IBM_Plex_Mono'] text-[14px] space-y-4 mb-4 max-h-[calc(100vh-200px)] overflow-y-auto pr-2" id="chat-messages">
                <p class="text-[#18a000]">Hi! I'm Carlos's AI sidekick. I can navigate you through his portfolio and share insights about his process, values, and strategic thinking. Ask me anything about his projects, experience, or dive deeper into his approach!</p>
            </div>
            <div class="font-['IBM_Plex_Mono'] text-[14px] mb-4 flex" id="chat-input-container">
                <span class="text-black mt-[2px]">></span>
                <div class="relative flex-1 ml-2">
                    <textarea 
                        class="bg-transparent border-none font-['IBM_Plex_Mono'] text-[14px] w-full outline-none text-black resize-none overflow-hidden p-0 leading-normal"
                        placeholder="Ask me anything..."
                        id="chat-input"
                        rows="1"
                        style="height: 20px;"
                    ></textarea>
                </div>
            </div>
        </div>
        <div class="bg-[#18a000] p-4 cursor-pointer transition-all duration-500 ease-in-out" id="sidekick-button" onclick="toggleSidekick()">
            <h3 class="text-white text-center font-['IBM_Plex_Mono'] font-bold transition-all duration-500 ease-in-out" id="sidekick-text">AI Sidekick</h3>
        </div>
    </div>

    <script>
        // Cursor functionality
        const cursor = document.getElementById('cursor');
        let links = document.querySelectorAll('a');
        let buttons = document.querySelectorAll('button');
        let isNavigating = false;
        let lastAINavigationPosition = null; // Track AI's final position

        document.addEventListener('mousemove', (e) => {
            if (!isNavigating && !lastAINavigationPosition) {
                cursor.style.left = e.clientX + 'px';
                cursor.style.top = e.clientY + 'px';
            } else if (!isNavigating && lastAINavigationPosition) {
                // User is moving the mouse after AI navigation - clear stored position
                lastAINavigationPosition = null;
                cursor.style.left = e.clientX + 'px';
                cursor.style.top = e.clientY + 'px';
            }
            // If isNavigating is true or lastAINavigationPosition exists, don't update cursor position
        });

        links.forEach(link => {
            link.addEventListener('mouseenter', () => {
                if (!isNavigating && !lastAINavigationPosition) {
                    cursor.classList.add('hover');
                }
            });
            
            link.addEventListener('mouseleave', () => {
                cursor.classList.remove('hover');
            });
        });

        buttons.forEach(button => {
            button.addEventListener('mouseenter', () => {
                if (!isNavigating && !lastAINavigationPosition) {
                    cursor.classList.add('hover');
                }
            });
            
            button.addEventListener('mouseleave', () => {
                cursor.classList.remove('hover');
            });
        });

        document.addEventListener('mouseleave', () => {
            cursor.style.display = 'none';
        });

        document.addEventListener('mouseenter', () => {
            cursor.style.display = 'block';
        });

        // Function to smoothly transition cursor from AI to user control
        function transitionCursorFromAI() {
            if (lastAINavigationPosition) {
                // Keep cursor at AI's final position
                cursor.style.left = lastAINavigationPosition.x + 'px';
                cursor.style.top = lastAINavigationPosition.y + 'px';
            }
            // Set isNavigating to false but keep the stored position
            isNavigating = false;
            // The stored position will be cleared only when user moves the mouse
        }

        // Enhanced responses with navigation capabilities
        const responses = {
            'microsoft': {
                keywords: ['microsoft', 'copilot', 'microsoft health', 'bachelors program', 'big tech', 'big tech company', 'tech company', 'large company', 'enterprise'],
                response: "Carlos worked at Microsoft on their healthcare initiatives! He helped design the Bachelors in Microsoft Health program. Let me show you that project.",
                action: () => {
                    const cursor = document.getElementById('cursor');
                    const projectsLink = document.querySelector('a[href="projects.html"]');
                    
                    cursor.classList.add('navigating');
                    
                    const rect = projectsLink.getBoundingClientRect();
                    cursor.style.transition = 'all 1s ease';
                    cursor.style.left = (rect.left + rect.width/2) + 'px';
                    cursor.style.top = (rect.top + rect.height/2) + 'px';
                    
                    setTimeout(() => {
                        sessionStorage.setItem('isNavigating', 'true');
                        sessionStorage.setItem('targetProject', 'bachelors-microsoft-health');
                        sessionStorage.setItem('scrollToProject', 'true');
                        window.location.href = 'projects.html';
                    }, 1000);
                }
            },
            'ai': {
                keywords: ['ai', 'artificial intelligence', 'gpt', 'chatgpt', 'ai technologies', 'machine learning', 'ai experience', 'chatgpt', 'gpt', 'openai'],
                response: "Carlos has extensive AI experience! He built an AI Research Workbook at Northwestern Medicine and worked on Microsoft Copilot integration. Let me show you his AI Research Workbook project.",
                action: () => {
                    const cursor = document.getElementById('cursor');
                    const projectsLink = document.querySelector('a[href="projects.html"]');
                    
                    cursor.classList.add('navigating');
                    
                    const rect = projectsLink.getBoundingClientRect();
                    cursor.style.transition = 'all 1s ease';
                    cursor.style.left = (rect.left + rect.width/2) + 'px';
                    cursor.style.top = (rect.top + rect.height/2) + 'px';
                    
                    setTimeout(() => {
                        sessionStorage.setItem('isNavigating', 'true');
                        sessionStorage.setItem('targetProject', 'ai-research-workbook');
                        sessionStorage.setItem('scrollToProject', 'true');
                        window.location.href = 'projects.html';
                    }, 1000);
                }
            },
            'northwestern': {
                keywords: ['northwestern', 'northwestern medicine', 'nm scholars', 'ai research workbook', 'last project', 'recent work', 'latest project'],
                response: "I'll show you his Northwestern Medicine projects! He has two major projects there - the AI Research Workbook and the NM Scholars Program. Let me show you his most recent work.",
                action: () => {
                    const cursor = document.getElementById('cursor');
                    const projectsLink = document.querySelector('a[href="projects.html"]');
                    
                    cursor.classList.add('navigating');
                    
                    const rect = projectsLink.getBoundingClientRect();
                    cursor.style.transition = 'all 1s ease';
                    cursor.style.left = (rect.left + rect.width/2) + 'px';
                    cursor.style.top = (rect.top + rect.height/2) + 'px';
                    
                    setTimeout(() => {
                        sessionStorage.setItem('isNavigating', 'true');
                        sessionStorage.setItem('targetProject', 'ai-research-workbook');
                        sessionStorage.setItem('scrollToProject', 'true');
                        window.location.href = 'projects.html';
                    }, 1000);
                }
            },
            'healthcare': {
                keywords: ['healthcare', 'medical', 'clinical', 'health', 'medicine', 'healthcare experience'],
                response: "Carlos has significant healthcare experience! He worked at Northwestern Medicine on clinical learning programs and AI research tools. Let me show you his NM Scholars Program.",
                action: () => {
                    const cursor = document.getElementById('cursor');
                    const projectsLink = document.querySelector('a[href="projects.html"]');
                    
                    cursor.classList.add('navigating');
                    
                    const rect = projectsLink.getBoundingClientRect();
                    cursor.style.transition = 'all 1s ease';
                    cursor.style.left = (rect.left + rect.width/2) + 'px';
                    cursor.style.top = (rect.top + rect.height/2) + 'px';
                    
                    setTimeout(() => {
                        sessionStorage.setItem('isNavigating', 'true');
                        sessionStorage.setItem('targetProject', 'nm-scholars-program');
                        sessionStorage.setItem('scrollToProject', 'true');
                        window.location.href = 'projects.html';
                    }, 1000);
                }
            },
            'home': {
                keywords: ['home', 'main page', 'go back', 'return', 'landing page'],
                response: "Let me take you back to the home page!",
                action: () => {
                    const cursor = document.getElementById('cursor');
                    const homeLink = document.querySelector('a[href="index.html"]');
                    
                    cursor.classList.add('navigating');
                    
                    const rect = homeLink.getBoundingClientRect();
                    cursor.style.transition = 'all 1s ease';
                    cursor.style.left = (rect.left + rect.width/2) + 'px';
                    cursor.style.top = (rect.top + rect.height/2) + 'px';
                    
                    setTimeout(() => {
                        sessionStorage.setItem('isNavigating', 'true');
                        window.location.href = 'index.html';
                    }, 1000);
                }
            },
            'projects': {
                keywords: ['projects', 'work', 'portfolio', 'case studies', 'what has he built', 'show me his work'],
                response: "I'll take you to his projects page where you can see all his detailed work!",
                action: () => {
                    const cursor = document.getElementById('cursor');
                    const projectsLink = document.querySelector('a[href="projects.html"]');
                    
                    cursor.classList.add('navigating');
                    
                    const rect = projectsLink.getBoundingClientRect();
                    cursor.style.transition = 'all 1s ease';
                    cursor.style.left = (rect.left + rect.width/2) + 'px';
                    cursor.style.top = (rect.top + rect.height/2) + 'px';
                    
                    setTimeout(() => {
                        sessionStorage.setItem('isNavigating', 'true');
                        window.location.href = 'projects.html';
                    }, 1000);
                }
            },
            'experience': {
                keywords: ['experience', 'work history', 'jobs', 'career', 'background', 'what has he done'],
                response: "Let me show you his experience! You can see his work history on the home page or explore his specific projects.",
                action: () => {
                    const cursor = document.getElementById('cursor');
                    const homeLink = document.querySelector('a[href="index.html"]');
                    
                    cursor.classList.add('navigating');
                    
                    const rect = homeLink.getBoundingClientRect();
                    cursor.style.transition = 'all 1s ease';
                    cursor.style.left = (rect.left + rect.width/2) + 'px';
                    cursor.style.top = (rect.top + rect.height/2) + 'px';
                    
                    setTimeout(() => {
                        sessionStorage.setItem('isNavigating', 'true');
                        window.location.href = 'index.html#resume';
                    }, 1000);
                }
            },
            'about': {
                keywords: ['about', 'who is', 'tell me about', 'background', 'who is carlos'],
                response: "Let me show you more about Carlos! You're already on the About page, but I can tell you he's a design strategist working at the intersection of healthcare, education, and human-centered AI.",
                action: null
            },
            'contact': {
                keywords: ['contact', 'reach', 'email', 'connect', 'get in touch', 'how to contact'],
                response: "I'll show you his contact information! You can find his email, LinkedIn, and GitHub in the contact dropdown.",
                action: () => {
                    const cursor = document.getElementById('cursor');
                    const contactButton = document.querySelector('.contact-dropdown');
                    const contactDropdownMenu = document.querySelector('.contact-dropdown-menu');
                    
                    cursor.classList.add('navigating');
                    
                    // Move cursor to contact button
                    const rect = contactButton.getBoundingClientRect();
                    cursor.style.transition = 'all 1s ease';
                    cursor.style.left = (rect.left + rect.width/2) + 'px';
                    cursor.style.top = (rect.top + rect.height/2) + 'px';
                    
                    setTimeout(() => {
                        // Show the dropdown
                        contactDropdownMenu.classList.remove('invisible', 'opacity-0');
                        contactDropdownMenu.classList.add('opacity-100', 'visible');
                        
                        setTimeout(() => {
                            cursor.style.transition = 'transform 0.2s ease, background-color 0.3s ease';
                            cursor.classList.remove('navigating');
                        }, 500);
                    }, 1000);
                }
            },
            'resume': {
                keywords: ['resume', 'cv', 'experience', 'work history', 'download resume'],
                response: "I'll open his resume for you! It's a Google Docs link with his full experience and background.",
                action: () => {
                    const cursor = document.getElementById('cursor');
                    const resumeLink = document.querySelector('a[href*="docs.google.com"]');
                    
                    cursor.classList.add('navigating');
                    
                    const rect = resumeLink.getBoundingClientRect();
                    cursor.style.transition = 'all 1s ease';
                    cursor.style.left = (rect.left + rect.width/2) + 'px';
                    cursor.style.top = (rect.top + rect.height/2) + 'px';
                    
                    setTimeout(() => {
                        resumeLink.click();
                        cursor.style.transition = 'transform 0.2s ease, background-color 0.3s ease';
                        cursor.classList.remove('navigating');
                    }, 1000);
                }
            },
            'oldest': {
                keywords: ['oldest', 'older', 'oldest project', 'older project', 'first project', 'earliest project', 'microsoft health'],
                response: "I'll show you his oldest project - the Microsoft Health Bachelors program! This was his first major project where he learned to balance enterprise constraints with human-centered design.",
                action: () => {
                    // Set context for Microsoft Health project (only for Simple Context sidekick)
                    if (simpleSidekick && !(simpleSidekick instanceof OpenAISidekick)) {
                        simpleSidekick.setContext('microsoft health', "Carlos worked on the Bachelors in Microsoft Health program, his oldest project where he learned to balance enterprise constraints with human-centered design.");
                    }
                    
                    const cursor = document.getElementById('cursor');
                    const projectsLink = document.querySelector('a[href="projects.html"]');
                    
                    cursor.classList.add('navigating');
                    
                    const rect = projectsLink.getBoundingClientRect();
                    cursor.style.transition = 'all 1s ease';
                    cursor.style.left = (rect.left + rect.width/2) + 'px';
                    cursor.style.top = (rect.top + rect.height/2) + 'px';
                    
                    setTimeout(() => {
                        // Store the final position before navigation
                        lastAINavigationPosition = {
                            x: rect.left + rect.width/2,
                            y: rect.top + rect.height/2
                        };
                        sessionStorage.setItem('isNavigating', 'true');
                        sessionStorage.setItem('targetProject', 'bachelors-microsoft-health');
                        sessionStorage.setItem('scrollToProject', 'true');
                        
                        console.log('Navigating to oldest project (Microsoft Health)');
                        
                        window.location.href = 'projects.html';
                    }, 1000);
                }
            },
            'blog': {
                keywords: ['blog', 'blog posts', 'articles', 'writing', 'blog section'],
                response: "I'll take you to his blog section on the homepage where you can read his latest articles and insights!",
                action: () => {
                    const cursor = document.getElementById('cursor');
                    
                    cursor.classList.add('navigating');
                    
                    // Scroll to blog section on homepage
                    const blogSection = document.querySelector('#blog');
                    if (blogSection) {
                        const rect = blogSection.getBoundingClientRect();
                        cursor.style.transition = 'all 1s ease';
                        cursor.style.left = (rect.left + rect.width/2) + 'px';
                        cursor.style.top = (rect.top + rect.height/2) + 'px';
                        
                        setTimeout(() => {
                            // Store the final position before scrolling
                            lastAINavigationPosition = {
                                x: rect.left + rect.width/2,
                                y: rect.top + rect.height/2
                            };
                            
                            // Smooth scroll to blog section
                            blogSection.scrollIntoView({ behavior: 'smooth' });
                            
                            setTimeout(() => {
                                cursor.style.transition = 'transform 0.2s ease, background-color 0.3s ease';
                                cursor.classList.remove('navigating');
                                transitionCursorFromAI(); // Use smooth transition
                            }, 1000);
                        }, 1000);
                    } else {
                        // If we're not on homepage, navigate to it and scroll to blog
                        sessionStorage.setItem('scrollToSection', 'blog');
                        window.location.href = 'index.html';
                    }
                }
            }
        };

        // AI Sidekick functionality
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        let isTyping = false;

        // Auto-resize textarea
        function autoResize() {
            chatInput.style.height = 'auto';
            chatInput.style.height = chatInput.scrollHeight + 'px';
        }

        chatInput.addEventListener('input', autoResize);

        // Load chat history from sessionStorage
        function loadChatHistory() {
            const history = JSON.parse(sessionStorage.getItem('chatHistory')) || [];
            chatMessages.innerHTML = '';
            if (history.length === 0) {
                addMessage("Hi! I'm Carlos's AI sidekick. I can navigate you through his portfolio and share insights about his process, values, and strategic thinking. Ask me anything about his projects, experience, or dive deeper into his approach!", false);
            } else {
                history.forEach(msg => {
                    const p = document.createElement('p');
                    p.className = msg.isUser ? 'text-black' : 'text-[#18a000]';
                    if (msg.isUser) {
                        p.textContent = `> ${msg.text}`;
                    } else {
                        p.textContent = msg.text;
                    }
                    chatMessages.appendChild(p);
                });
            }
        }

        // Session tracking for chat history management
        function initializeSession() {
            const isFreshSession = !sessionStorage.getItem('sessionActive');
            const isAINavigation = sessionStorage.getItem('isNavigating') === 'true';
            const referrer = document.referrer;
            const isInternalNavigation = referrer && (
                referrer.includes('index.html') ||
                referrer.includes('projects.html') ||
                referrer.includes('about.html') ||
                referrer.includes('ai-research-workbook.html') ||
                referrer.includes('bachelors-microsoft-health.html') ||
                referrer.includes('nm-scholars-program.html')
            );
            
            // Check if this is a page refresh by looking at performance navigation type
            const isPageRefresh = performance.navigation.type === 1 || 
                                (performance.getEntriesByType('navigation')[0] && 
                                 performance.getEntriesByType('navigation')[0].type === 'reload');

            // Clear chat history if it's a fresh session (page refresh or direct access)
            // Preserve chat history during any internal navigation (AI or manual)
            if ((isFreshSession && !isInternalNavigation && !isAINavigation) || isPageRefresh) {
                sessionStorage.removeItem('chatHistory');
                sessionStorage.setItem('sessionActive', 'true');
            }
        }

        // Load chat history when page loads
        initializeSession();
        loadChatHistory();

        // Initialize Simple Context AI Sidekick
        let simpleSidekick = null;
        
        // Sidekick toggle state
        let sidekickCollapsed = false;
        
        // Track if this is a navigation (not refresh)
        let isNavigation = false;
        
        // Set up beforeunload listener to detect navigation vs refresh
        window.addEventListener('beforeunload', function() {
            // If we're navigating to another page in our site, mark it as navigation
            const currentUrl = window.location.href;
            const nextUrl = sessionStorage.getItem('nextUrl');
            
            if (nextUrl && nextUrl !== currentUrl) {
                isNavigation = true;
                sessionStorage.setItem('isNavigation', 'true');
            }
        });
        
        // Set up click listeners for navigation links
        document.addEventListener('DOMContentLoaded', function() {
            const links = document.querySelectorAll('a[href]');
            links.forEach(link => {
                link.addEventListener('click', function() {
                    const href = this.getAttribute('href');
                    if (href && !href.startsWith('http') && !href.startsWith('#')) {
                        sessionStorage.setItem('nextUrl', window.location.origin + href);
                    }
                });
            });
        });
        
        // Initialize sidekick state from sessionStorage
        function initializeSidekickState() {
            console.log('=== INITIALIZATION DEBUG ===');
            const savedState = sessionStorage.getItem('sidekickCollapsed');
            const wasNavigation = sessionStorage.getItem('isNavigation');
            
            console.log('Initializing sidekick state:', savedState);
            console.log('Was navigation:', wasNavigation);
            
            // Clear the navigation flag
            sessionStorage.removeItem('isNavigation');
            sessionStorage.removeItem('nextUrl');
            
            // Apply collapsed state if it was a navigation and sidekick was collapsed
            if (savedState === 'true' && wasNavigation === 'true') {
                console.log('Applying collapsed state from navigation...');
                // Apply collapsed state on page load
                const aiSidekick = document.getElementById('ai-sidekick');
                const chatContainer = document.getElementById('chat-container');
                const sidekickText = document.getElementById('sidekick-text');
                const mainContent = document.getElementById('main-content');
                
                console.log('Elements found during initialization:', {
                    aiSidekick: !!aiSidekick,
                    chatContainer: !!chatContainer,
                    sidekickText: !!sidekickText,
                    mainContent: !!mainContent
                });
                
                if (aiSidekick && chatContainer && sidekickText && mainContent) {
                    // Set initial collapsed state
                    console.log('Setting collapsed state...');
                    chatContainer.style.display = 'none';
                    aiSidekick.style.width = '80px';
                    aiSidekick.style.maxWidth = '80px';
                    sidekickText.style.fontSize = '14px';
                    sidekickText.textContent = 'AI';
                    mainContent.style.width = '75%';
                    mainContent.style.marginLeft = '12.5%'; // Center the 75% content
                    sidekickCollapsed = true;
                    
                    console.log('Applied collapsed state successfully');
                } else {
                    console.error('Some elements not found during initialization');
                }
            } else {
                console.log('Not navigation or no saved state - resetting to expanded state');
                // Reset to expanded state on refresh, direct access, or external navigation
                sessionStorage.setItem('sidekickCollapsed', 'false');
                sidekickCollapsed = false;
            }
            console.log('=== END INITIALIZATION DEBUG ===');
        }
        
        // Toggle AI Sidekick function
        function toggleSidekick() {
            console.log('=== TOGGLE SIDEKICK DEBUG ===');
            console.log('Toggle sidekick called, current state:', sidekickCollapsed);
            
            const aiSidekick = document.getElementById('ai-sidekick');
            const chatContainer = document.getElementById('chat-container');
            const sidekickText = document.getElementById('sidekick-text');
            const mainContent = document.getElementById('main-content');
            const chatInput = document.getElementById('chat-input');
            
            console.log('Elements found:', {
                aiSidekick: !!aiSidekick,
                chatContainer: !!chatContainer,
                sidekickText: !!sidekickText,
                mainContent: !!mainContent,
                chatInput: !!chatInput
            });
            
            // Check if we're on mobile
            const isMobile = window.innerWidth <= 768;
            
            if (sidekickCollapsed) {
                console.log('Expanding sidekick...');
                
                if (isMobile) {
                    // Mobile fullscreen mode
                    aiSidekick.classList.add('mobile-fullscreen');
                    mainContent.classList.add('mobile-hidden');
                    sidekickText.textContent = '✕';
                } else {
                    // Desktop mode
                    // Force show the container - remove all conflicting styles
                    chatContainer.style.display = 'block';
                    chatContainer.style.visibility = 'visible';
                    chatContainer.style.opacity = '1';
                    chatContainer.style.maxHeight = 'none';
                    chatContainer.style.overflow = 'visible';
                    chatContainer.style.height = 'auto';
                    chatContainer.style.width = '100%';
                    
                    aiSidekick.style.width = '25%';
                    aiSidekick.style.maxWidth = '394px';
                    sidekickText.style.fontSize = '14px';
                    sidekickText.textContent = 'AI Sidekick';
                    mainContent.style.width = '75%';
                    mainContent.style.marginLeft = '0';
                }
                
                // Ensure input is visible and functional
                if (chatInput) {
                    chatInput.style.display = 'block';
                    chatInput.style.visibility = 'visible';
                    chatInput.style.opacity = '1';
                    chatInput.focus();
                    console.log('Input field restored successfully');
                }
                
                sidekickCollapsed = false;
                sessionStorage.setItem('sidekickCollapsed', 'false');
                console.log('Sidekick expanded, state saved');
            } else {
                console.log('Collapsing sidekick...');
                
                if (isMobile) {
                    // Mobile collapse mode
                    aiSidekick.classList.remove('mobile-fullscreen');
                    mainContent.classList.remove('mobile-hidden');
                    sidekickText.textContent = 'AI';
                } else {
                    // Desktop collapse mode
                    chatContainer.style.display = 'none';
                    aiSidekick.style.width = '80px';
                    aiSidekick.style.maxWidth = '80px';
                    sidekickText.style.fontSize = '14px';
                    sidekickText.textContent = 'AI';
                    mainContent.style.width = '75%';
                    mainContent.style.marginLeft = '12.5%'; // Center the 75% content
                }
                
                sidekickCollapsed = true;
                sessionStorage.setItem('sidekickCollapsed', 'true');
                console.log('Sidekick collapsed, state saved');
            }
            console.log('=== END TOGGLE DEBUG ===');
        }

        // Manual test function for debugging
        window.testSidekickExpansion = function() {
            console.log('=== MANUAL TEST ABOUT PAGE ===');
            console.log('Current sidekickCollapsed state:', sidekickCollapsed);
            console.log('Session storage value:', sessionStorage.getItem('sidekickCollapsed'));

            const aiSidekick = document.getElementById('ai-sidekick');
            const chatContainer = document.getElementById('chat-container');
            const sidekickText = document.getElementById('sidekick-text');
            const mainContent = document.getElementById('main-content');
            const chatInput = document.getElementById('chat-input');

            console.log('All elements found:', {
                aiSidekick: !!aiSidekick,
                chatContainer: !!chatContainer,
                sidekickText: !!sidekickText,
                mainContent: !!mainContent,
                chatInput: !!chatInput
            });

            if (chatContainer) {
                console.log('Chat container current styles:', {
                    display: chatContainer.style.display,
                    visibility: chatContainer.style.visibility,
                    opacity: chatContainer.style.opacity,
                    maxHeight: chatContainer.style.maxHeight,
                    overflow: chatContainer.style.overflow,
                    height: chatContainer.style.height,
                    width: chatContainer.style.width
                });
            }

            // Try to force expand
            if (sidekickCollapsed && chatContainer) {
                console.log('Attempting to force expand...');
                chatContainer.style.display = 'block';
                chatContainer.style.visibility = 'visible';
                chatContainer.style.opacity = '1';
                chatContainer.style.maxHeight = 'none';
                chatContainer.style.overflow = 'visible';
                chatContainer.style.height = 'auto';
                chatContainer.style.width = '100%';
                sidekickCollapsed = false;
                console.log('Force expand completed');
            }
        };
        
        // Check if OpenAI API key is available
        const openaiApiKey = localStorage.getItem('openai_api_key');
        
        if (openaiApiKey) {
            console.log('Using OpenAI sidekick');
            simpleSidekick = new OpenAISidekick(openaiApiKey);
        } else {
            console.log('Using Simple Context sidekick (fallback)');
            simpleSidekick = new SimpleContextSidekick();
        }

        function addMessage(text, isUser = false, animate = true) {
            const p = document.createElement('p');
            p.className = isUser ? 'text-black' : 'text-[#18a000]';
            if (isUser) {
                p.textContent = `> ${text}`;
            } else if (!animate) {
                p.innerHTML = text.replace(/\n/g, '<br>');
            }
            chatMessages.appendChild(p);

            if (!isUser && animate) {
                animateText(p, text);
            }

            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Save to sessionStorage
            const history = JSON.parse(sessionStorage.getItem('chatHistory')) || [];
            history.push({ text, isUser });
            sessionStorage.setItem('chatHistory', JSON.stringify(history));
        }

        // Typing animation for dots
        function animateTypingDots(element) {
            let dots = 0;
            const interval = setInterval(() => {
                dots = (dots + 1) % 4;
                element.textContent = '.'.repeat(dots);
            }, 500);
            return interval;
        }

        // Text animation character by character
        async function animateText(element, text) {
            let currentText = '';
            const delay = 30; // ms between each character

            for (let i = 0; i < text.length; i++) {
                currentText += text[i];
                element.innerHTML = currentText;
                chatMessages.scrollTop = chatMessages.scrollHeight;
                await new Promise(resolve => setTimeout(resolve, delay));
            }
        }

        // Handle chat input
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                const message = chatInput.value.trim();
                if (message && !isTyping) {
                    addMessage(message, true);
                    chatInput.value = '';
                    autoResize();
                    
                    isTyping = true;
                    const typingElement = document.createElement('p');
                    typingElement.className = 'text-[#18a000]';
                    chatMessages.appendChild(typingElement);
                    
                    const typingInterval = animateTypingDots(typingElement);
                    
                    setTimeout(() => {
                        clearInterval(typingInterval);
                        chatMessages.removeChild(typingElement);
                        
                        try {
                        const response = findResponse(message);
                        console.log('Response received:', response);
                        
                        if (response && response.text) {
                            addMessage(response.text, false);
                            
                            if (response.action) {
                                setTimeout(() => {
                                    response.action();
                                }, 1000);
                            }
                        } else {
                            console.error('Invalid response:', response);
                            addMessage("I'm sorry, I encountered an error processing your request. Please try again.", false);
                        }
                    } catch (error) {
                        console.error('Error in findResponse:', error);
                        addMessage("I'm sorry, I encountered an error processing your request. Please try again.", false);
                    }
                        addMessage(response.text, false);
                        
                        if (response.action) {
                            setTimeout(() => {
                                response.action();
                            }, 1000);
                        }
                        
                        isTyping = false;
                    }, 1000);
                }
            }
        });

        // Ensure chat history persists across navigation
        window.addEventListener('beforeunload', () => {
            // Don't clear chat history on page navigation
        });

        document.addEventListener('DOMContentLoaded', () => {
            const cursor = document.getElementById('cursor');
            // Check if we're coming from a navigation action
            if (sessionStorage.getItem('isNavigating') === 'true') {
                isNavigating = true;
                cursor.classList.add('navigating');
                
                // Position cursor at the about link position (since we're on the about page)
                const aboutLink = document.querySelector('a[href="about.html"]');
                if (aboutLink) {
                    const rect = aboutLink.getBoundingClientRect();
                    cursor.style.left = (rect.left + rect.width/2) + 'px';
                    cursor.style.top = (rect.top + rect.height/2) + 'px';
                    
                    // Store the position for smooth transition
                    lastAINavigationPosition = {
                        x: rect.left + rect.width/2,
                        y: rect.top + rect.height/2
                    };
                }
                
                setTimeout(() => {
                    cursor.style.transition = 'transform 0.2s ease, background-color 0.3s ease';
                    cursor.classList.remove('navigating');
                    sessionStorage.removeItem('isNavigating');
                    sessionStorage.removeItem('targetProject'); // Clear targetProject as well
                    transitionCursorFromAI(); // Use smooth transition
                }, 100);
            }
        });

        // Add click handling for contact dropdown
        document.addEventListener('DOMContentLoaded', () => {
            const contactButton = document.querySelector('.contact-dropdown');
            const contactDropdownMenu = document.querySelector('.contact-dropdown-menu');
            
            if (contactButton && contactDropdownMenu) {
                contactButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Toggle dropdown visibility
                    const isVisible = contactDropdownMenu.classList.contains('visible');
                    
                    if (isVisible) {
                        contactDropdownMenu.classList.remove('opacity-100', 'visible');
                        contactDropdownMenu.classList.add('opacity-0', 'invisible');
                    } else {
                        contactDropdownMenu.classList.remove('invisible', 'opacity-0');
                        contactDropdownMenu.classList.add('opacity-100', 'visible');
                    }
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', (event) => {
                    if (!contactDropdownMenu.contains(event.target) && !contactButton.contains(event.target)) {
                        contactDropdownMenu.classList.remove('opacity-100', 'visible');
                        contactDropdownMenu.classList.add('opacity-0', 'invisible');
                    }
                });
            }
        });

        function findResponse(input) {
            const lowercaseInput = input.toLowerCase();
            console.log('findResponse called with:', input);
            
            // FIRST: Check if this is a context continuation (prioritize context over navigation)
            if (simpleSidekick) {
                console.log('Checking for context continuation first...');
                
                // Check if this looks like a context continuation
                const contextContinuationPhrases = ['tell me more about it', 'tell me more', 'more about it', 'more details', 'what else', 'continue', 'go on', 'elaborate', 'explain more', 'more', 'it'];
                const isContextContinuation = contextContinuationPhrases.some(phrase => lowercaseInput.includes(phrase));
                
                if (isContextContinuation) {
                    console.log('Context continuation detected, using sidekick response');
                    const simpleResponse = simpleSidekick.getResponse(input);
                    return {
                        text: simpleResponse,
                        action: null
                    };
                }
            }
            
            // SECOND: Check for navigation keywords (but exclude context continuation phrases)
            const contextContinuationPhrases = ['tell me more about it', 'tell me more', 'more about it', 'more details', 'what else', 'continue', 'go on', 'elaborate', 'explain more', 'more', 'it'];
            const navigationKeywords = ['take me', 'go to', 'show me', 'navigate', 'latest', 'recent', 'project', 'projects', 'about', 'home', 'contact', 'resume'];
            
            // Only check navigation if it's NOT a context continuation
            const isContextContinuation = contextContinuationPhrases.some(phrase => lowercaseInput.includes(phrase));
            const isNavigationQuery = !isContextContinuation && navigationKeywords.some(keyword => lowercaseInput.includes(keyword));
            
            if (isNavigationQuery) {
                console.log('Navigation query detected, checking navigation responses first');
                // Check navigation responses first for navigation queries
                for (const category in responses) {
                    if (responses[category].keywords.some(keyword => lowercaseInput.includes(keyword))) {
                        console.log('Found navigation response for:', category);
                        
                        // Update context for navigation responses (only for Simple Context sidekick)
                        if (simpleSidekick && responses[category].response && !(simpleSidekick instanceof OpenAISidekick)) {
                            // Extract topic from the navigation response
                            const topic = simpleSidekick.extractTopicFromResponse(responses[category].response);
                            if (topic) {
                                console.log('Updating context for navigation response:', topic);
                                simpleSidekick.setContext(topic, responses[category].response);
                            }
                        }
                        
                        return {
                            text: responses[category].response,
                            action: responses[category].action
                        };
                    }
                }
                
                // If no navigation response found, don't fall through to OpenAI for navigation queries
                console.log('No navigation response found, but this is a navigation query - not using OpenAI');
                return {
                    text: "I can help you navigate to Carlos's projects! Try asking me to 'take me to the Northwestern Medicine projects' or 'show me the AI Research Workbook'.",
                    action: null
                };
            }
            
            // THIRD: Try the simple context sidekick for insight queries
            if (simpleSidekick) {
                console.log('Simple sidekick available, searching...');
                console.log('Simple sidekick object:', simpleSidekick);
                
                const simpleResponse = simpleSidekick.getResponse(input);
                console.log('Simple response:', simpleResponse);
                
                // Check if we got a meaningful response (not the default)
                const defaultResponse = simpleSidekick.getDefaultResponse();
                console.log('Default response:', defaultResponse);
                console.log('Response matches default?', simpleResponse === defaultResponse);
                
                if (simpleResponse && simpleResponse !== defaultResponse) {
                    console.log('Using simple response');
                    return {
                        text: simpleResponse,
                        action: null
                    };
                } else {
                    console.log('Simple response was default, falling back to navigation');
                }
            } else {
                console.log('Simple sidekick not available');
            }
            
            // Fall back to navigation responses
            for (const category in responses) {
                if (responses[category].keywords.some(keyword => lowercaseInput.includes(keyword))) {
                    return {
                        text: responses[category].response,
                        action: responses[category].action
                    };
                }
            }
            
            // If no exact match, provide a helpful response
            return {
                text: "I can help you navigate through Carlos's portfolio and share insights about his process, values, and strategic thinking! Try asking about his projects, experience, AI work, healthcare experience, Northwestern Medicine projects, or dive deeper into his process, values, strategy, collaboration style, or innovation approach. What would you like to explore?",
                action: null
            };
        }
        
        // About Me Animation and Sidekick Initialization
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize sidekick state from sessionStorage AFTER DOM is ready
            initializeSidekickState();
            
            const aboutAnimation = document.getElementById('about-animation');
            if (!aboutAnimation) return;
            
            const zones = aboutAnimation.querySelectorAll('[data-zone]');
            const animations = aboutAnimation.querySelectorAll('[data-animation]');
            
            let isHovering = false;
            let activeAnimations = new Set();
            
            // Handle mouse enter for the entire animation section
            aboutAnimation.addEventListener('mouseenter', () => {
                isHovering = true;
                activeAnimations.clear();
            });
            
            // Handle mouse leave for the entire animation section
            aboutAnimation.addEventListener('mouseleave', () => {
                isHovering = false;
                
                // Roll away all animations with staggered timing
                const allAnimations = Array.from(animations);
                allAnimations.forEach((anim, index) => {
                    setTimeout(() => {
                        if (anim.dataset.animation.includes('vertical') || anim.style.transform.includes('scaleY')) {
                            anim.style.transform = 'scaleY(0)';
                        } else {
                            anim.style.transform = 'scaleX(0)';
                        }
                    }, index * 50);
                });
            });
            
            let mouseX = 0;
            let mouseY = 0;
            
            // Track mouse position
            aboutAnimation.addEventListener('mousemove', (e) => {
                const rect = aboutAnimation.getBoundingClientRect();
                mouseX = e.clientX - rect.left;
                mouseY = e.clientY - rect.top;
            });
            
            zones.forEach(zone => {
                zone.addEventListener('mouseenter', () => {
                    if (!isHovering) return;
                    
                    // Get all available animations
                    const allAnimations = Array.from(animations);
                    const availableAnimations = allAnimations.filter(anim => !activeAnimations.has(anim.dataset.animation));
                    
                    // Randomly select 2-3 animations to trigger
                    const numToTrigger = Math.floor(Math.random() * 2) + 2;
                    const selectedAnimations = [];
                    
                    for (let i = 0; i < numToTrigger && availableAnimations.length > 0; i++) {
                        const randomIndex = Math.floor(Math.random() * availableAnimations.length);
                        const selectedAnim = availableAnimations.splice(randomIndex, 1)[0];
                        selectedAnimations.push(selectedAnim);
                    }
                    
                    // Trigger selected animations with random delays
                    selectedAnimations.forEach((anim, index) => {
                        if (!activeAnimations.has(anim.dataset.animation)) {
                            activeAnimations.add(anim.dataset.animation);
                            const randomDelay = Math.random() * 200 + 100;
                            
                            setTimeout(() => {
                                // Generate random opacity between 0.6 and 1.0
                                const randomOpacity = Math.random() * 0.4 + 0.6;
                                anim.style.opacity = randomOpacity;
                                
                                // Generate random line length scaling between 50% and 150%
                                const randomLengthScale = Math.random() * 1.0 + 0.5;
                                
                                // Apply random length scaling
                                if (anim.dataset.animation.includes('vertical') || anim.style.transform.includes('scaleY')) {
                                    const currentHeight = anim.style.height || '25%';
                                    const newHeight = `calc(${currentHeight} * ${randomLengthScale})`;
                                    anim.style.height = newHeight;
                                } else {
                                    const currentWidth = anim.style.width || '25%';
                                    const newWidth = `calc(${currentWidth} * ${randomLengthScale})`;
                                    anim.style.width = newWidth;
                                }
                                
                                // Position near cursor but stay within animation area
                                const rect = aboutAnimation.getBoundingClientRect();
                                const maxLeft = rect.width * 0.9; // Stay within 90% of animation area
                                
                                if (anim.dataset.animation.includes('vertical') || anim.style.transform.includes('scaleY')) {
                                    const newLeft = Math.max(4, Math.min(maxLeft, mouseX - 10));
                                    anim.style.left = newLeft + 'px';
                                    anim.style.transform = 'scaleY(1)';
                                } else {
                                    const newTop = Math.max(4, Math.min(rect.height - 20, mouseY - 10));
                                    anim.style.top = newTop + 'px';
                                    anim.style.transform = 'scaleX(1)';
                                }
                            }, randomDelay);
                        }
                    });
                });
            });
            
            // Initial random animation on page load
            function triggerInitialAnimation() {
                const rect = aboutAnimation.getBoundingClientRect();
                const maxLeft = rect.width * 0.9; // Stay within 90% of animation area
                
                // Get all available animations
                const allAnimations = Array.from(animations);
                
                // Randomly select 3-4 animations to trigger
                const numToTrigger = Math.floor(Math.random() * 2) + 3;
                const selectedAnimations = [];
                
                for (let i = 0; i < numToTrigger && allAnimations.length > 0; i++) {
                    const randomIndex = Math.floor(Math.random() * allAnimations.length);
                    const selectedAnim = allAnimations.splice(randomIndex, 1)[0];
                    selectedAnimations.push(selectedAnim);
                }
                
                // Trigger selected animations with staggered delays
                selectedAnimations.forEach((anim, index) => {
                    const delay = index * 300 + 500; // Start after 500ms, then every 300ms
                    
                    setTimeout(() => {
                        // Generate random opacity between 0.6 and 1.0
                        const randomOpacity = Math.random() * 0.4 + 0.6;
                        anim.style.opacity = randomOpacity;
                        
                        // Generate random line length scaling between 50% and 150%
                        const randomLengthScale = Math.random() * 1.0 + 0.5;
                        
                        // Apply random length scaling
                        if (anim.dataset.animation.includes('vertical') || anim.style.transform.includes('scaleY')) {
                            const currentHeight = anim.style.height || '25%';
                            const newHeight = `calc(${currentHeight} * ${randomLengthScale})`;
                            anim.style.height = newHeight;
                        } else {
                            const currentWidth = anim.style.width || '25%';
                            const newWidth = `calc(${currentWidth} * ${randomLengthScale})`;
                            anim.style.width = newWidth;
                        }
                        
                        // Position randomly in the animation area (respecting image protection zone)
                        if (anim.dataset.animation.includes('vertical') || anim.style.transform.includes('scaleY')) {
                            const newLeft = Math.max(4, Math.min(maxLeft, Math.random() * maxLeft));
                            anim.style.left = newLeft + 'px';
                            anim.style.transform = 'scaleY(1)';
                        } else {
                            const newTop = Math.max(4, Math.min(rect.height - 20, Math.random() * rect.height));
                            anim.style.top = newTop + 'px';
                            anim.style.transform = 'scaleX(1)';
                        }
                        
                        // Add to active animations
                        activeAnimations.add(anim.dataset.animation);
                        
                        // Auto-remove after 3-5 seconds
                        setTimeout(() => {
                            if (anim.dataset.animation.includes('vertical') || anim.style.transform.includes('scaleY')) {
                                anim.style.transform = 'scaleY(0)';
                            } else {
                                anim.style.transform = 'scaleX(0)';
                            }
                            activeAnimations.delete(anim.dataset.animation);
                        }, Math.random() * 2000 + 3000); // 3-5 seconds
                        
                    }, delay);
                });
            }
            
            // Trigger initial animation after a short delay
            setTimeout(triggerInitialAnimation, 1000);
        });
        
        // Copy email to clipboard function
        function copyEmail() {
            const email = 'c.a.rodriguez1999@gmail.com';
            
            // Use the modern clipboard API if available
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(email).then(() => {
                    showEmailPopup();
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                    fallbackCopyEmail(email);
                });
            } else {
                // Fallback for older browsers or non-secure contexts
                fallbackCopyEmail(email);
            }
        }
        
        // Fallback copy method for older browsers
        function fallbackCopyEmail(email) {
            const textArea = document.createElement('textarea');
            textArea.value = email;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showEmailPopup();
            } catch (err) {
                console.error('Fallback copy failed: ', err);
            }
            
            document.body.removeChild(textArea);
        }
        
        // Show email copy popup
        function showEmailPopup() {
            const popup = document.getElementById('email-popup');
            const popupLine = document.getElementById('popup-line');
            
            // Reset any existing timeouts
            if (popup.timeoutId) {
                clearTimeout(popup.timeoutId);
            }
            
            // Show popup with fade-in animation
            popup.style.display = 'block';
            
            // Trigger animation after a brief delay to ensure display is set
            setTimeout(() => {
                popup.style.opacity = '1';
                popup.style.transform = 'translateY(0)';
                
                // Start rolling line animation down as text appears
                setTimeout(() => {
                    popupLine.style.transform = 'scaleY(1)';
                }, 100);
            }, 10);
            
            // Hide popup after 3 seconds
            popup.timeoutId = setTimeout(() => {
                // Start rolling line animation up and fade out popup simultaneously
                popupLine.style.transform = 'scaleY(0)';
                popup.style.opacity = '0';
                popup.style.transform = 'translateY(-10px)';
                
                // Hide completely after fade
                setTimeout(() => {
                    popup.style.display = 'none';
                }, 300);
            }, 3000);
        }
        
        // Mobile menu functionality
        document.addEventListener('DOMContentLoaded', () => {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const hamburgerIcon = document.getElementById('hamburger-icon');
            const xIcon = document.getElementById('x-icon');
            
            if (mobileMenuBtn && mobileMenu) {
                mobileMenuBtn.addEventListener('click', () => {
                    const isVisible = mobileMenu.classList.contains('hidden');
                    
                    if (isVisible) {
                        mobileMenu.classList.remove('hidden');
                        hamburgerIcon.classList.add('hidden');
                        xIcon.classList.remove('hidden');
                    } else {
                        mobileMenu.classList.add('hidden');
                        hamburgerIcon.classList.remove('hidden');
                        xIcon.classList.add('hidden');
                    }
                });
            }
            
            // Mobile contact dropdown functionality
            const contactButton = document.getElementById('mobile-contact-dropdown');
            const contactDropdownMenu = document.getElementById('mobile-contact-menu');
            const contactLine = document.getElementById('mobile-contact-line');
            
            if (contactButton && contactDropdownMenu) {
                contactButton.addEventListener('click', () => {
                    const isVisible = contactDropdownMenu.classList.contains('visible');
                    
                    if (isVisible) {
                        contactDropdownMenu.classList.remove('opacity-100', 'visible');
                        contactDropdownMenu.classList.add('opacity-0', 'invisible');
                    } else {
                        contactDropdownMenu.classList.remove('invisible', 'opacity-0');
                        contactDropdownMenu.classList.add('opacity-100', 'visible');
                    }
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', (event) => {
                    if (!contactDropdownMenu.contains(event.target) && !contactButton.contains(event.target)) {
                        contactDropdownMenu.classList.remove('opacity-100', 'visible');
                        contactDropdownMenu.classList.add('opacity-0', 'invisible');
                    }
                });
            }
        });
        
        // Initialize sidekick state for mobile
        function initializeSidekickState() {
            const savedState = sessionStorage.getItem('sidekickCollapsed');
            if (savedState === null) {
                // Default to collapsed on mobile
                const isMobile = window.innerWidth <= 768;
                if (isMobile) {
                    sidekickCollapsed = true;
                    sessionStorage.setItem('sidekickCollapsed', 'true');
                }
            } else {
                sidekickCollapsed = savedState === 'true';
            }
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            const isMobile = window.innerWidth <= 768;
            const aiSidekick = document.getElementById('ai-sidekick');
            const mainContent = document.getElementById('main-content');
            
            if (isMobile) {
                // On mobile, ensure proper mobile styling
                if (sidekickCollapsed) {
                    aiSidekick.classList.remove('mobile-fullscreen');
                    mainContent.classList.remove('mobile-hidden');
                }
            } else {
                // On desktop, remove mobile classes
                aiSidekick.classList.remove('mobile-fullscreen');
                mainContent.classList.remove('mobile-hidden');
            }
        });
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            initializeSidekickState();
        });
    </script>
    <style>
        /* Add custom scrollbar styling */
        #chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        
        #chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }
        
        #chat-messages::-webkit-scrollbar-thumb {
            background: #6b7280;
            border-radius: 3px;
        }
        
        #chat-messages::-webkit-scrollbar-thumb:hover {
            background: #4b5563;
        }

        #chat-messages p {
            white-space: pre-line;
        }
    </style>
</body>
</html>
